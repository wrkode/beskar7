apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: beskar7-system
spec:
  replicas: 3  # Large HA deployment with 3 replicas
  template:
    spec:
      containers:
      - name: manager
        args:
        - --leader-elect=true
        - --leader-elect-lease-duration=15s
        - --leader-elect-renew-deadline=10s
        - --leader-elect-retry-period=2s
        - --leader-elect-release-on-cancel=true
        - --enable-security-monitoring=true
        - --metrics-bind-address=:8080
        - --health-probe-bind-address=:8081
        # Add resources optimized for large deployments
        resources:
          limits:
            cpu: 1000m
            memory: 1Gi
            ephemeral-storage: 2Gi
          requests:
            cpu: 200m
            memory: 256Mi
            ephemeral-storage: 100Mi
      # Add anti-affinity for large deployments
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchLabels:
                  control-plane: controller-manager
              topologyKey: kubernetes.io/hostname 