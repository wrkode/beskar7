# Adds namespace to all resources.
namespace: beskar7-system

# Value of this field is prepended to the
# names of all resources, e.g. a deployment named
# "controller-manager" becomes "my-deployment-controller-manager".
# namePrefix: my-deployment-

# Labels to add to all resources and selectors.
commonLabels:
  app.kubernetes.io/name: beskar7
  app.kubernetes.io/version: v0.2.6

bases:
- ../crd
- ../rbac
- ../manager
- ../security
# [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in
# crd/kustomization.yaml
- ../webhook
# [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'. 'WEBHOOK' components are required.
- ../certmanager

patchesStrategicMerge:
# Protect the /metrics endpoint by putting it behind auth.
# If you want your controller-manager to expose the /metrics
# endpoint w/o any authn/z, please comment the following line.
#- ../manager/manager_auth_proxy_patch.yaml
- manager_auth_proxy_patch.yaml # Reference the local file now

# Mount the controller config file for loading manager configurations
# through a ComponentConfig type
#- manager_config_patch.yaml


# TODO(user): Add transformations like Annotations, Labels, ConfigMapReplacements

# Images for the Beskar7 manager. The image name `controller` must match
# the name used in config/manager/manager.yaml.
images:
- name: controller
  newName: ghcr.io/wrkode/beskar7/beskar7
  newTag: v0.2.6

# Replace VERSION placeholder with actual version
replacements:
- source:
    kind: Namespace
    name: beskar7-system
    fieldPath: metadata.labels.[app.kubernetes.io/version]
  targets:
  - select:
      kind: "*"
    fieldPaths:
    - metadata.labels.[app.kubernetes.io/version]